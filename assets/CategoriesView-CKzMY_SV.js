import{m as S,n as q,d as B,o as j}from"./api-BodTUH2d.js";import{l as F,m as N,r as c,a1 as G,N as z,a as R,o as x,c as $,b as e,d,w as C,a2 as O,e as r,n as L,t as n,f as P,A as H,F as D,U as J}from"./index-CX7ZakWi.js";import{_ as K,a as Q}from"./DelModal-vMHQc3df.js";import{_ as W}from"./UploadComponent-B5zdR82R.js";const X={class:"modal-dialog modal-dialog-centered"},Y={class:"modal-content overflow-hidden"},Z={class:"p-11"},ee={class:"modal-title title mb-8",id:"categoryEditModalLabel"},te=e("span",{class:"titleIcon bg-dark-subtl"},[e("i",{class:"bi bi-pencil-fill"})],-1),ae={class:"mb-8"},se=e("label",{for:"title",class:"form-label"},[e("span",{class:"text-danger"},"*"),r(" 分類標題： ")],-1),le=e("label",{for:"title",class:"form-label"},[e("span",{class:"text-danger"},"*"),r(" 分類圖片 ")],-1),oe={class:"mb-4 text-center text-danger"},de={class:"flex-fill mx-lg-16"},ne={key:0},ie={class:"d-flex px-11 py-8 bg-light"},ce=["onClick"],re=["disabled"],ue={__name:"CategoryEditModal",props:{tempCategory:{type:Object,default(){return{id:"",title:"",categoryImgUrl:"",createdAt:"",updatedAt:""}}}},emits:["getCategories"],setup(T,{expose:A,emit:I}){const M=F(),u=N(),{openLoading:g,closeLoading:h}=M,{pushMessage:m}=u,p=c(null),{openModal:U,hideModal:_}=G(p),s=c({id:"",title:"",categoryImgUrl:"",createdAt:"",updatedAt:""});A({openModal:U,hideModal:_});const b=T,w=I;z(b,l=>{s.value=l.tempCategory});async function V(l,{resetForm:t}){var i,y;g();const a=s.value.id?S:q,o=s.value.id?"更新":"新增";try{const f=await a({title:s.value.title,categoryImgUrl:s.value.categoryImgUrl},s.value.id),{status:E}=f.data;E==="success"?(m({style:"success",title:`${o}成功`,text:`分類${o}成功，請等待載入畫面`}),t(),w("getCategories")):m({style:"danger",title:`${o}失敗`,text:`分類${o}失敗，請重整網頁`}),h(),_()}catch(f){m({style:"danger",title:`${o}失敗`,text:((y=(i=f.response)==null?void 0:i.data)==null?void 0:y.message)||`分類${o}失敗，請重整網頁`}),h()}}function k(l){s.value.categoryImgUrl=l}return(l,t)=>{const a=R("VField"),o=R("ErrorMessage"),i=R("VForm");return x(),$("div",{class:"modal fade",id:"categoryEditModal",tabindex:"-1","aria-labelledby":"categoryEditModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false",ref_key:"categoryEditModalRef",ref:p},[e("div",X,[e("div",Y,[d(i,{class:"modal-body p-0",ref:"form",onSubmit:V},{default:C(({errors:y,meta:f,resetForm:E})=>[e("div",Z,[e("h1",ee,[te,O(l.$slots,"modal-header",{},()=>[r("標題")])]),e("div",ae,[se,d(a,{type:"text",name:"分類標題",id:"title",class:L(["form-control",{"is-invalid":y.分類標題}]),placeholder:"請輸入分類標題",rules:"required",modelValue:s.value.title,"onUpdate:modelValue":t[0]||(t[0]=v=>s.value.title=v),required:""},null,8,["class","modelValue"]),d(o,{name:"分類標題",class:"invalid-feedback"})]),e("div",{class:L([s.value.createdAt?"mb-16":"mb-8"])},[le,d(a,{type:"text",id:"coverImgUrl",class:"d-none",name:"分類圖片",modelValue:s.value.categoryImgUrl,"onUpdate:modelValue":t[1]||(t[1]=v=>s.value.categoryImgUrl=v),rules:"required",required:""},null,8,["modelValue"]),d(o,{name:"分類圖片"},{default:C(({message:v})=>[e("p",oe,n(v),1)]),_:1}),e("div",de,[d(W,{"temp-image-url":s.value.categoryImgUrl,imageType:"icon",onUpdateImage:k},null,8,["temp-image-url"])])],2),s.value.createdAt?(x(),$("div",ne,[e("p",null,"建立時間："+n(l.$getTime(s.value.createdAt)),1),e("p",null,"更新時間："+n(l.$getTime(s.value.updatedAt)),1)])):P("",!0)]),e("div",ie,[e("button",{type:"button",class:"w-50 btn btn-outline-primary me-8","data-bs-dismiss":"modal",onClick:E}," 取消 ",8,ce),e("button",{type:"submit","aria-disabled":"true",class:L(["w-50 btn btn-primary",{disabled:!f.valid}]),disabled:!f.valid}," 確定送出 ",10,re)])]),_:3},512)])])],512)}}},ge=e("h1",{class:"mb-4 h3"},"分類管理",-1),me={class:"mb-8 text-end"},pe=e("i",{class:"bi bi-plus-lg me-8"},null,-1),_e={class:"table-responsive"},be={class:"table mb-14 align-middle"},ye=e("thead",null,[e("tr",{class:"table-active"},[e("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"ID 編號"),e("th",{class:"text-center"},"分類名稱"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"建立時間"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"更新時間"),e("th",{class:"text-center",width:"200"},"編輯")])],-1),fe={class:"d-none d-sm-table-cell text-center"},he={class:"d-flex flex-column flex-md-row justify-content-center align-items-center"},ve=["src"],xe={class:"d-none d-xxl-table-cell text-center"},$e={class:"d-none d-xxl-table-cell text-center"},Ce={class:"text-center"},Me={class:"btn-group btn-group-sm",role:"group"},Ue=["onClick"],ke=["onClick"],Ee={__name:"CategoriesView",setup(T){const A=F(),I=N(),{openLoading:M,closeLoading:u}=A,{pushMessage:g}=I,h=c([]),m=c({}),p=c(null),U=c(null),_=c({id:"",title:""}),s=c({id:"",title:"",categoryImgUrl:"",createdAt:"",updatedAt:""});async function b(l=1){var t,a;M();try{const o=await B({page:l});h.value=o.data.data.results,m.value=o.data.data.pagination,u()}catch(o){g({style:"danger",title:"載入失敗",text:((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.message)||"載入失敗，請重整網頁"}),u()}}async function w(l){var t,a,o;M();try{const i=await j(l),{status:y}=i.data;y==="success"?(g({style:"success",title:"刪除成功",text:"分類刪除成功，請等待載入畫面"}),b()):g({style:"danger",title:"刪除失敗",text:"分類刪除失敗，請重整網頁"}),(t=p.value)==null||t.hideModal(),u()}catch(i){g({style:"danger",title:"刪除失敗",text:((o=(a=i.response)==null?void 0:a.data)==null?void 0:o.message)||"分類刪除失敗，請重整網頁"}),u()}}function V(l){var t;_.value={id:l._id,title:l.title},(t=p.value)==null||t.openModal()}function k(l,t){var a;l==="create"?s.value={id:"",title:"",categoryImgUrl:"",createdAt:"",updatedAt:""}:s.value={id:t._id,title:t.title,categoryImgUrl:t.categoryImgUrl,createdAt:t.createdAt,updatedAt:t.updatedAt},(a=U.value)==null||a.openModal()}return H(()=>{b()}),(l,t)=>(x(),$(D,null,[ge,e("div",me,[e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=a=>k("create"))},[pe,r(" 新增分類 ")])]),e("div",_e,[e("table",be,[ye,e("tbody",null,[(x(!0),$(D,null,J(h.value,a=>(x(),$("tr",{key:a._id},[e("td",fe,"#"+n(a._id.slice(-5)),1),e("td",he,[e("img",{src:a.categoryImgUrl,class:"thumbnail me-4"},null,8,ve),r(" "+n(a.title),1)]),e("td",xe,n(l.$getTime(a.createdAt)),1),e("td",$e,n(l.$getTime(a.updatedAt)),1),e("td",Ce,[e("div",Me,[e("button",{type:"button",class:"btn btn-outline-dark",onClick:o=>k("edit",a)}," 編輯 ",8,Ue),e("button",{type:"button",class:"btn btn-outline-danger",onClick:o=>V(a)}," 刪除 ",8,ke)])])]))),128))])])]),d(K,{pagination:m.value,onUpdatePage:b},null,8,["pagination"]),d(Q,{ref_key:"delModalRef",ref:p,"del-id":_.value.id,onDelItem:w},{"modal-header":C(()=>[r(" 刪除分類 ")]),"modal-content":C(()=>[r(" 確定要刪除 "),e("strong",null," 分類： "+n(_.value.title),1)]),_:1},8,["del-id"]),d(ue,{ref_key:"categoryEditModalRef",ref:U,"temp-category":s.value,onGetCategories:b},{"modal-header":C(()=>[r(n(s.value.id?"編輯分類":"新增分類"),1)]),_:1},8,["temp-category"])],64))}};export{Ee as default};
