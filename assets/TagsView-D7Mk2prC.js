import{q as U,r as q,e as B,s as G}from"./api-Bo_f3VkR.js";import{l as F,m as N,r as c,a1 as I,N as j,a as V,o as y,c as x,b as t,d as f,w as T,a2 as z,e as h,n as R,t as r,f as O,A as P,F as D,U as H}from"./index-C4YH-ltT.js";import{_ as J,a as K}from"./DelModal-DydJ4_F8.js";const Q={class:"modal-dialog modal-dialog-centered"},W={class:"modal-content overflow-hidden"},X={class:"p-11"},Y={class:"modal-title title mb-8",id:"tagEditModalLabel"},Z=t("span",{class:"title-icon bg-dark-subtl"},[t("i",{class:"bi bi-pencil-fill"})],-1),tt=t("label",{for:"title",class:"form-label"},[t("span",{class:"text-danger"},"*"),h(" 標籤標題： ")],-1),et={key:0},at={class:"d-flex px-11 py-8 bg-light"},st=["onClick"],lt=["disabled"],dt={__name:"TagEditModal",props:{tempTag:{type:Object,default(){return{id:"",title:"",createdAt:"",updatedAt:""}}}},emits:["getTags"],setup(L,{expose:k,emit:A}){const $=F(),u=N(),{openLoading:p,closeLoading:v}=$,{pushMessage:g}=u,_=c(null),{openModal:M,hideModal:m}=I(_),s=c({id:"",title:"",createdAt:"",updatedAt:""});k({openModal:M,hideModal:m});const b=L,w=A;j(b,o=>{s.value=o.tempTag});async function C(o,{resetForm:l}){var d,n;p();const a=s.value.id?U:q,e=s.value.id?"更新":"新增";try{const i=await a({title:s.value.title},s.value.id),{status:E}=i.data;E==="success"?(g({style:"success",title:`${e}成功`,text:`標籤${e}成功，請等待載入畫面`}),l(),w("getTags")):g({style:"danger",title:`${e}失敗`,text:`標籤${e}失敗，請重整網頁`}),v(),m()}catch(i){g({style:"danger",title:`${e}失敗`,text:((n=(d=i.response)==null?void 0:d.data)==null?void 0:n.message)||`標籤${e}失敗，請重整網頁`}),v()}}return(o,l)=>{const a=V("VField"),e=V("ErrorMessage"),d=V("VForm");return y(),x("div",{class:"modal fade",id:"tagEditModal",tabindex:"-1","aria-labelledby":"tagEditModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false",ref_key:"tagEditModalRef",ref:_},[t("div",Q,[t("div",W,[f(d,{class:"modal-body p-0",ref:"form",onSubmit:C},{default:T(({errors:n,meta:i,resetForm:E})=>[t("div",X,[t("h1",Y,[Z,z(o.$slots,"modal-header",{},()=>[h("標題")])]),t("div",{class:R({"mb-8":s.value.createdAt})},[tt,f(a,{type:"text",name:"標籤標題",id:"title",class:R(["form-control",{"is-invalid":n.標籤標題}]),placeholder:"請輸入標籤標題",rules:"required",modelValue:s.value.title,"onUpdate:modelValue":l[0]||(l[0]=S=>s.value.title=S),required:""},null,8,["class","modelValue"]),f(e,{name:"標籤標題",class:"invalid-feedback"})],2),s.value.createdAt?(y(),x("div",et,[t("p",null,"建立時間："+r(o.$getTime(s.value.createdAt)),1),t("p",null,"更新時間："+r(o.$getTime(s.value.updatedAt)),1)])):O("",!0)]),t("div",at,[t("button",{type:"button",class:"w-50 btn btn-outline-primary me-8","data-bs-dismiss":"modal",onClick:E}," 取消 ",8,st),t("button",{type:"submit","aria-disabled":"true",class:R(["w-50 btn btn-primary",{disabled:!i.valid}]),disabled:!i.valid}," 確定送出 ",10,lt)])]),_:3},512)])])],512)}}},ot=t("h1",{class:"mb-4 h3"},"標籤管理",-1),nt={class:"mb-8 text-end"},it=t("i",{class:"bi bi-plus-lg me-8"},null,-1),ct={class:"table-responsive"},rt={class:"table mb-14 align-middle"},ut=t("thead",null,[t("tr",{class:"table-active"},[t("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"ID 編號"),t("th",{class:"text-center"},"標籤名稱"),t("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"建立時間"),t("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"更新時間"),t("th",{class:"text-center",width:"200"},"編輯")])],-1),pt={class:"d-none d-sm-table-cell text-center"},gt={class:"text-center"},_t={class:"d-none d-xxl-table-cell text-center"},mt={class:"d-none d-xxl-table-cell text-center"},bt={class:"text-center"},ht={class:"btn-group btn-group-sm",role:"group"},ft=["onClick"],vt=["onClick"],Mt={__name:"TagsView",setup(L){const k=F(),A=N(),{openLoading:$,closeLoading:u}=k,{pushMessage:p}=A,v=c([]),g=c({}),_=c(null),M=c(null),m=c({id:"",title:""}),s=c({id:"",title:"",createdAt:"",updatedAt:""});async function b(l=1){var a,e;$();try{const d=await B({page:l});v.value=d.data.data.results,g.value=d.data.data.pagination,u()}catch(d){p({style:"danger",title:"載入失敗",text:((e=(a=d.response)==null?void 0:a.data)==null?void 0:e.message)||"載入失敗，請重整網頁"}),u()}}async function w(l){var a,e,d;$();try{const n=await G(l),{status:i}=n.data;i==="success"?(p({style:"success",title:"刪除成功",text:"標籤刪除成功，請等待載入畫面"}),b()):p({style:"danger",title:"刪除失敗",text:"標籤刪除失敗，請重整網頁"}),(a=_.value)==null||a.hideModal(),u()}catch(n){p({style:"danger",title:"刪除失敗",text:((d=(e=n.response)==null?void 0:e.data)==null?void 0:d.message)||"標籤刪除失敗，請重整網頁"}),u()}}function C(l){var a;m.value={id:l._id,title:l.title},(a=_.value)==null||a.openModal()}function o(l,a){var e;l==="create"?s.value={id:"",title:"",createdAt:"",updatedAt:""}:s.value={id:a._id,title:a.title,createdAt:a.createdAt,updatedAt:a.updatedAt},(e=M.value)==null||e.openModal()}return P(()=>{b()}),(l,a)=>(y(),x(D,null,[ot,t("div",nt,[t("button",{type:"button",class:"btn btn-primary",onClick:a[0]||(a[0]=e=>o("create"))},[it,h(" 新增標籤 ")])]),t("div",ct,[t("table",rt,[ut,t("tbody",null,[(y(!0),x(D,null,H(v.value,e=>(y(),x("tr",{key:e._id},[t("td",pt,"#"+r(e._id.slice(-5)),1),t("td",gt,r(e.title),1),t("td",_t,r(l.$getTime(e.createdAt)),1),t("td",mt,r(l.$getTime(e.updatedAt)),1),t("td",bt,[t("div",ht,[t("button",{type:"button",class:"btn btn-outline-dark",onClick:d=>o("edit",e)}," 編輯 ",8,ft),t("button",{type:"button",class:"btn btn-outline-danger",onClick:d=>C(e)}," 刪除 ",8,vt)])])]))),128))])])]),f(J,{pagination:g.value,onUpdatePage:b},null,8,["pagination"]),f(K,{ref_key:"delModalRef",ref:_,"del-id":m.value.id,onDelItem:w},{"modal-header":T(()=>[h(" 刪除標籤 ")]),"modal-content":T(()=>[h(" 確定要刪除 "),t("strong",null," 標籤： "+r(m.value.title),1)]),_:1},8,["del-id"]),f(dt,{ref_key:"tagEditModalRef",ref:M,"temp-tag":s.value,onGetTags:b},{"modal-header":T(()=>[h(r(s.value.id?"編輯標籤":"新增標籤"),1)]),_:1},8,["temp-tag"])],64))}};export{Mt as default};
