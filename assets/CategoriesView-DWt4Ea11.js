import{n as U,o as B,d as q,p as G}from"./api-Bo_f3VkR.js";import{l as T,m as N,r as c,a1 as I,N as j,a as R,o as v,c as x,b as e,d as h,w as M,a2 as z,e as y,n as L,t as r,f as O,A as P,F,U as H}from"./index-C4YH-ltT.js";import{_ as J,a as K}from"./DelModal-DydJ4_F8.js";const Q={class:"modal-dialog modal-dialog-centered"},W={class:"modal-content overflow-hidden"},X={class:"p-11"},Y={class:"modal-title title mb-8",id:"categoryEditModalLabel"},Z=e("span",{class:"title-icon bg-dark-subtl"},[e("i",{class:"bi bi-pencil-fill"})],-1),ee=e("label",{for:"title",class:"form-label"},[e("span",{class:"text-danger"},"*"),y(" 分類標題： ")],-1),te={key:0},ae={class:"d-flex px-11 py-8 bg-light"},se=["onClick"],le=["disabled"],oe={__name:"CategoryEditModal",props:{tempCategory:{type:Object,default(){return{id:"",title:"",createdAt:"",updatedAt:""}}}},emits:["getCategories"],setup(D,{expose:k,emit:A}){const C=T(),u=N(),{openLoading:p,closeLoading:f}=C,{pushMessage:g}=u,_=c(null),{openModal:$,hideModal:m}=I(_),s=c({id:"",title:"",createdAt:"",updatedAt:""});k({openModal:$,hideModal:m});const b=D,w=A;j(b,d=>{s.value=d.tempCategory});async function E(d,{resetForm:l}){var o,n;p();const a=s.value.id?U:B,t=s.value.id?"更新":"新增";try{const i=await a({title:s.value.title},s.value.id),{status:V}=i.data;V==="success"?(g({style:"success",title:`${t}成功`,text:`分類${t}成功，請等待載入畫面`}),l(),w("getCategories")):g({style:"danger",title:`${t}失敗`,text:`分類${t}失敗，請重整網頁`}),f(),m()}catch(i){g({style:"danger",title:`${t}失敗`,text:((n=(o=i.response)==null?void 0:o.data)==null?void 0:n.message)||`分類${t}失敗，請重整網頁`}),f()}}return(d,l)=>{const a=R("VField"),t=R("ErrorMessage"),o=R("VForm");return v(),x("div",{class:"modal fade",id:"categoryEditModal",tabindex:"-1","aria-labelledby":"categoryEditModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false",ref_key:"categoryEditModalRef",ref:_},[e("div",Q,[e("div",W,[h(o,{class:"modal-body p-0",ref:"form",onSubmit:E},{default:M(({errors:n,meta:i,resetForm:V})=>[e("div",X,[e("h1",Y,[Z,z(d.$slots,"modal-header",{},()=>[y("標題")])]),e("div",{class:L({"mb-8":s.value.createdAt})},[ee,h(a,{type:"text",name:"分類標題",id:"title",class:L(["form-control",{"is-invalid":n.分類標題}]),placeholder:"請輸入分類標題",rules:"required",modelValue:s.value.title,"onUpdate:modelValue":l[0]||(l[0]=S=>s.value.title=S),required:""},null,8,["class","modelValue"]),h(t,{name:"分類標題",class:"invalid-feedback"})],2),s.value.createdAt?(v(),x("div",te,[e("p",null,"建立時間："+r(d.$getTime(s.value.createdAt)),1),e("p",null,"更新時間："+r(d.$getTime(s.value.updatedAt)),1)])):O("",!0)]),e("div",ae,[e("button",{type:"button",class:"w-50 btn btn-outline-primary me-8","data-bs-dismiss":"modal",onClick:V}," 取消 ",8,se),e("button",{type:"submit","aria-disabled":"true",class:L(["w-50 btn btn-primary",{disabled:!i.valid}]),disabled:!i.valid}," 確定送出 ",10,le)])]),_:3},512)])])],512)}}},de=e("h1",{class:"mb-4 h3"},"分類管理",-1),ne={class:"mb-8 text-end"},ie=e("i",{class:"bi bi-plus-lg me-8"},null,-1),ce={class:"table-responsive"},re={class:"table mb-14 align-middle"},ue=e("thead",null,[e("tr",{class:"table-active"},[e("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"ID 編號"),e("th",{class:"text-center"},"分類名稱"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"建立時間"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"更新時間"),e("th",{class:"text-center",width:"200"},"編輯")])],-1),pe={class:"d-none d-sm-table-cell text-center"},ge={class:"text-center"},_e={class:"d-none d-xxl-table-cell text-center"},me={class:"d-none d-xxl-table-cell text-center"},be={class:"text-center"},ye={class:"btn-group btn-group-sm",role:"group"},he=["onClick"],fe=["onClick"],$e={__name:"CategoriesView",setup(D){const k=T(),A=N(),{openLoading:C,closeLoading:u}=k,{pushMessage:p}=A,f=c([]),g=c({}),_=c(null),$=c(null),m=c({id:"",title:""}),s=c({id:"",title:"",createdAt:"",updatedAt:""});async function b(l=1){var a,t;C();try{const o=await q({page:l});f.value=o.data.data.results,g.value=o.data.data.pagination,u()}catch(o){p({style:"danger",title:"載入失敗",text:((t=(a=o.response)==null?void 0:a.data)==null?void 0:t.message)||"載入失敗，請重整網頁"}),u()}}async function w(l){var a,t,o;C();try{const n=await G(l),{status:i}=n.data;i==="success"?(p({style:"success",title:"刪除成功",text:"分類刪除成功，請等待載入畫面"}),b()):p({style:"danger",title:"刪除失敗",text:"分類刪除失敗，請重整網頁"}),(a=_.value)==null||a.hideModal(),u()}catch(n){p({style:"danger",title:"刪除失敗",text:((o=(t=n.response)==null?void 0:t.data)==null?void 0:o.message)||"分類刪除失敗，請重整網頁"}),u()}}function E(l){var a;m.value={id:l._id,title:l.title},(a=_.value)==null||a.openModal()}function d(l,a){var t;l==="create"?s.value={id:"",title:"",createdAt:"",updatedAt:""}:s.value={id:a._id,title:a.title,createdAt:a.createdAt,updatedAt:a.updatedAt},(t=$.value)==null||t.openModal()}return P(()=>{b()}),(l,a)=>(v(),x(F,null,[de,e("div",ne,[e("button",{type:"button",class:"btn btn-primary",onClick:a[0]||(a[0]=t=>d("create"))},[ie,y(" 新增分類 ")])]),e("div",ce,[e("table",re,[ue,e("tbody",null,[(v(!0),x(F,null,H(f.value,t=>(v(),x("tr",{key:t._id},[e("td",pe,"#"+r(t._id.slice(-5)),1),e("td",ge,r(t.title),1),e("td",_e,r(l.$getTime(t.createdAt)),1),e("td",me,r(l.$getTime(t.updatedAt)),1),e("td",be,[e("div",ye,[e("button",{type:"button",class:"btn btn-outline-dark",onClick:o=>d("edit",t)}," 編輯 ",8,he),e("button",{type:"button",class:"btn btn-outline-danger",onClick:o=>E(t)}," 刪除 ",8,fe)])])]))),128))])])]),h(J,{pagination:g.value,onUpdatePage:b},null,8,["pagination"]),h(K,{ref_key:"delModalRef",ref:_,"del-id":m.value.id,onDelItem:w},{"modal-header":M(()=>[y(" 刪除分類 ")]),"modal-content":M(()=>[y(" 確定要刪除 "),e("strong",null," 分類： "+r(m.value.title),1)]),_:1},8,["del-id"]),h(oe,{ref_key:"categoryEditModalRef",ref:$,"temp-category":s.value,onGetCategories:b},{"modal-header":M(()=>[y(r(s.value.id?"編輯分類":"新增分類"),1)]),_:1},8,["temp-category"])],64))}};export{$e as default};
