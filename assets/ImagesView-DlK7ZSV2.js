import{t as C,u as T}from"./api-DxEg9CdQ.js";import{r as i,V,o as p,c as b,b as e,W as M,e as m,l as S,m as B,j as P,F as I,L as j,d as $,w as u,O as F,t as l}from"./index-DlbT9Ik_.js";import{_ as E,a as G}from"./DelModal-DFTdoJuw.js";const O={class:"modal-dialog modal-dialog-centered"},W={class:"modal-content overflow-hidden"},q={class:"modal-body p-0"},z={class:"p-11"},H={class:"modal-title title mb-8",id:"imageModalLabel"},J=e("span",{class:"title-icon bg-dark-subtle"},[e("i",{class:"bi bi-pencil-fill"})],-1),K={class:"my-11 text-center"},Q=e("div",{class:"px-11 py-8 bg-light text-center"},[e("button",{type:"button",class:"w-50 btn btn-primary","data-bs-dismiss":"modal"},"關閉")],-1),X={__name:"ImageModal",setup(N,{expose:f}){const _=i(null),{openModal:g,hideModal:r}=V(_);return f({openModal:g,hideModal:r}),(n,x)=>(p(),b("div",{class:"modal fade",id:"imageModal",tabindex:"-1","aria-labelledby":"imageModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false",ref_key:"imageModalRef",ref:_},[e("div",O,[e("div",W,[e("div",q,[e("div",z,[e("h1",H,[J,M(n.$slots,"modal-header",{},()=>[m("標題")])]),e("div",K,[M(n.$slots,"modal-image",{},()=>[m("圖片")])]),M(n.$slots,"modal-content",{},()=>[m("內容")])]),Q])])])],512))}},Y=e("h1",{class:"mb-14 h3"},"圖片管理",-1),Z={class:"table-responsive"},ee={class:"table mb-14 align-middle"},te=e("thead",null,[e("tr",{class:"table-active"},[e("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"ID 編號"),e("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"圖片類型"),e("th",{class:"text-center"},"圖片網址"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"上傳會員"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"建立時間"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"更新時間"),e("th",{class:"text-center",width:"160"},"編輯")])],-1),ae={class:"d-none d-sm-table-cell text-center"},se={class:"d-none d-sm-table-cell text-center"},le={class:"text-center"},ne={class:"d-flex flex-column flex-md-row justify-content-center align-items-center"},oe=["src"],de=["href"],ce={class:"d-none d-xxl-table-cell text-center"},ie={class:"d-none d-xxl-table-cell text-center"},re={class:"d-none d-xxl-table-cell text-center"},me={class:"text-center"},ue={class:"btn-group btn-group-sm",role:"group"},_e=["onClick"],ge=["onClick"],he={class:"mb-8"},pe=["src"],be=["src"],fe=e("label",{for:"imageUrl",class:"form-label"},"網址連結：",-1),xe=["value"],Me={__name:"ImagesView",setup(N){const f=S(),_=B(),{openLoading:g,closeLoading:r}=f,{pushMessage:n}=_,x=i([]),w=i({}),v=i(null),U=i(null),h=i({id:"",imageUrl:""}),d=i({id:"",type:"",imageUrl:"",user:{nickName:""},createdAt:"",updatedAt:""});async function y(a=1){var s,t;g();try{const o=await C(),{data:c,status:k}=o.data;if(k==="success"){const A=F(c,a);x.value=A.result,w.value=A.pagination}else n({style:"danger",title:"載入失敗",text:"載入失敗，請重整網頁"});r()}catch(o){n({style:"danger",title:"載入失敗",text:((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||"載入失敗，請重整網頁"}),r()}}async function R(a){var s,t,o;g();try{const c=await T(a),{status:k}=c.data;k==="success"?(n({style:"success",title:"刪除成功",text:"圖片刪除成功，請等待載入畫面"}),y()):n({style:"danger",title:"刪除失敗",text:"圖片刪除失敗，請重整網頁"}),(s=v.value)==null||s.hideModal(),r()}catch(c){n({style:"danger",title:"刪除失敗",text:((o=(t=c.response)==null?void 0:t.data)==null?void 0:o.message)||"圖片刪除失敗，請重整網頁"}),r()}}function D(a){var s;h.value={id:a._id,imageUrl:a.imageUrl},(s=v.value)==null||s.openModal()}function L(a){var s,t;d.value={id:a._id,type:a.type,imageUrl:a.imageUrl,userNickName:(s=a.user)==null?void 0:s.nickName,createdAt:a.createdAt,updatedAt:a.updatedAt},(t=U.value)==null||t.openModal()}return P(()=>{y()}),(a,s)=>(p(),b(I,null,[Y,e("div",Z,[e("table",ee,[te,e("tbody",null,[(p(!0),b(I,null,j(x.value,t=>{var o;return p(),b("tr",{key:t._id},[e("td",ae,"#"+l(t._id.slice(-5)),1),e("td",se,l(t.type),1),e("td",le,[e("div",ne,[e("img",{src:t.imageUrl,alt:"",class:"thumbnail me-md-4"},null,8,oe),e("a",{href:t.imageUrl,target:"_blank",class:"text-decoration-underline"},"圖片連結",8,de)])]),e("td",ce,l((o=t.user)==null?void 0:o.nickName),1),e("td",ie,l(a.$getTime(t.createdAt)),1),e("td",re,l(a.$getTime(t.updatedAt)),1),e("td",me,[e("div",ue,[e("button",{type:"button",class:"btn btn-outline-dark",onClick:c=>L(t)}," 看更多 ",8,_e),e("button",{type:"button",class:"btn btn-outline-danger",onClick:c=>D(t)}," 刪除 ",8,ge)])])])}),128))])])]),$(E,{pagination:w.value,onUpdatePage:y},null,8,["pagination"]),$(G,{ref_key:"delModalRef",ref:v,"del-id":h.value.id,onDelItem:R},{"modal-header":u(()=>[m(" 刪除圖片 ")]),"modal-content":u(()=>[e("p",he,[m(" 確定要刪除 "),e("strong",null," 圖片：#"+l(h.value.id.slice(-5)),1)]),e("img",{src:h.value.imageUrl,class:"img-thumbnail",style:{"max-height":"12rem"}},null,8,pe)]),_:1},8,["del-id"]),$(X,{ref_key:"imageModalRef",ref:U},{"modal-header":u(()=>[m(" 圖片 #"+l(d.value.id.slice(-5)),1)]),"modal-image":u(()=>[e("img",{src:d.value.imageUrl,class:"img-thumbnail",style:{"max-height":"20rem"}},null,8,be)]),"modal-content":u(()=>[fe,e("input",{type:"text",id:"imageUrl",class:"form-control mb-8",value:d.value.imageUrl,disabled:""},null,8,xe),e("p",null,"上傳會員："+l(d.value.userNickName),1),e("p",null,"建立時間："+l(a.$getTime(d.value.createdAt)),1),e("p",null,"更新時間："+l(a.$getTime(d.value.updatedAt)),1)]),_:1},512)],64))}};export{Me as default};
