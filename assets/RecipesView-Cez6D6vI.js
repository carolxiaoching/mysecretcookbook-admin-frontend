import{c as S,e as V,d as A,i as B}from"./api-N8pudNG6.js";import{l as G,m as L,r,A as F,a as z,o as c,c as o,b as e,d as b,w as x,F as y,U as M,e as _,t as n,Q as N,S as E,Y as Q,n as Y}from"./index-CIqGYXyv.js";import{_ as j,a as q}from"./DelModal-ZxMk4JEI.js";const H=e("h1",{class:"mb-4 h3"},"食譜管理",-1),J={class:"mb-8 text-end"},K=e("i",{class:"bi bi-plus-lg me-8"},null,-1),O={class:"table-responsive"},W={class:"table align-middle mb-14"},X=e("thead",null,[e("tr",{class:"table-active"},[e("th",{class:"d-none d-md-table-cell text-center",width:"120"},"ID 編號"),e("th",{class:"text-center"},"食譜名稱"),e("th",{class:"d-none d-md-table-cell text-center",width:"120"},"分類"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"標籤"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"80"},"收藏人數"),e("th",{class:"d-none d-lg-table-cell text-center",width:"120"},"發布者"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"120"},"公開狀態"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"120"},"建立時間"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"120"},"更新時間"),e("th",{class:"text-center",width:"200"},"編輯")])],-1),Z={class:"d-none d-md-table-cell text-center"},ee={class:"text-center"},te={class:"d-flex align-items-center"},se=["src"],ae={key:1,class:"thumbnail me-4"},le=e("i",{class:"bi bi-person-fill"},null,-1),ne=[le],ce={class:"d-none d-md-table-cell text-center"},oe={class:"d-none d-xxl-table-cell text-center"},de={class:"d-flex flex-wrap mb-0 list-unstyled"},ie={class:"badge text-bg-secondary"},re={class:"d-none d-xxl-table-cell text-center"},_e={class:"d-none d-lg-table-cell text-center"},ue={class:"d-flex align-items-center"},he=["src"],ge={key:1,class:"thumbnail me-4 rounded-circle"},be=e("i",{class:"bi bi-person-fill"},null,-1),xe=[be],pe={class:"d-none d-xxl-table-cell text-center"},me={class:"d-none d-xxl-table-cell text-center"},fe={class:"d-none d-xxl-table-cell text-center"},ve={class:"text-center"},ye={class:"btn-group btn-group-sm",role:"group"},we=["onClick"],ke={class:"mb-8"},Ne={__name:"RecipesView",setup(Re){const P=G(),U=L(),{openLoading:p,closeLoading:d}=P,{pushMessage:u}=U,w=r([]),k=r([]),R=r([]),C=r({}),m=r(null),h=r({id:"",title:""});async function f(s=1){var a,l;p();try{const t=await S({page:s});w.value=t.data.data.results,C.value=t.data.data.pagination,d()}catch(t){u({style:"danger",title:"載入失敗",text:((l=(a=t.response)==null?void 0:a.data)==null?void 0:l.message)||"載入失敗，請重整網頁"}),d()}}async function $(){var s,a;p();try{const l=await V({noPagination:!0}),t=await A({noPagination:!0});R.value=l.data.data,k.value=t.data.data,await f(),d()}catch(l){u({style:"danger",title:"載入失敗",text:((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||"載入失敗，請重整網頁"}),d()}}async function I(s){var a,l,t;p();try{const i=await B(s),{status:g}=i.data;g==="success"?(u({style:"success",title:"刪除成功",text:"刪除成功，請等待載入畫面"}),f()):u({style:"danger",title:"刪除失敗",text:"刪除失敗，請重整網頁"}),(a=m.value)==null||a.hideModal(),d()}catch(i){u({style:"danger",title:"刪除失敗",text:((t=(l=i.response)==null?void 0:l.data)==null?void 0:t.message)||"刪除失敗，請重整網頁"}),d()}}function T(s){var a;h.value={id:s._id,title:s.title},(a=m.value)==null||a.openModal()}return F(()=>{$()}),(s,a)=>{const l=z("router-link");return c(),o(y,null,[H,e("div",J,[b(l,{to:"/dashboard/recipe/new",class:"btn btn-primary"},{default:x(()=>[K,_(" 新增食譜 ")]),_:1})]),e("div",O,[e("table",W,[X,e("tbody",null,[(c(!0),o(y,null,M(w.value,t=>{var i,g,D;return c(),o("tr",{key:t._id},[e("td",Z,"#"+n(t._id.slice(-5)),1),e("td",ee,[e("div",te,[t.coverImgUrl?(c(),o("img",{key:0,src:t.coverImgUrl,class:"thumbnail me-4"},null,8,se)):(c(),o("div",ae,ne)),_(" "+n(t.title),1)])]),e("td",ce,n(N(E)(k.value,t.category)),1),e("td",oe,[e("ul",de,[(c(!0),o(y,null,M(t.tags,v=>(c(),o("li",{class:"me-4 fs-6",key:v},[e("span",ie,n(N(Q)(R.value,v)),1)]))),128))])]),e("td",re,n(t.collectsCount),1),e("td",_e,[e("div",ue,[(i=t.user)!=null&&i.avatarImgUrl?(c(),o("img",{key:0,src:(g=t.user)==null?void 0:g.avatarImgUrl,class:"thumbnail me-4 rounded-circle"},null,8,he)):(c(),o("div",ge,xe)),_(" "+n((D=t.user)==null?void 0:D.nickName),1)])]),e("td",pe,[e("span",{class:Y(["badge",{"text-bg-primary":t.isPublic,"text-bg-light":!t.isPublic}])},n(t.isPublic?"公開":"私人"),3)]),e("td",me,n(s.$getTime(t.createdAt)),1),e("td",fe,n(s.$getTime(t.updatedAt)),1),e("td",ve,[e("div",ye,[b(l,{to:`/dashboard/recipe/${t._id}`,class:"btn btn-outline-dark"},{default:x(()=>[_(" 編輯 ")]),_:2},1032,["to"]),e("button",{type:"button",class:"btn btn-outline-danger",onClick:v=>T(t)}," 刪除 ",8,we)])])])}),128))])])]),b(j,{pagination:C.value,onUpdatePage:f},null,8,["pagination"]),b(q,{ref_key:"delModalRef",ref:m,"del-id":h.value.id,onDelItem:I},{"modal-header":x(()=>[_(" 刪除食譜 #"+n(h.value.id.slice(-5)),1)]),"modal-content":x(()=>[e("p",ke,[_(" 確定要刪除食譜： "),e("strong",null,n(h.value.title),1)])]),_:1},8,["del-id"])],64)}}};export{Ne as default};
