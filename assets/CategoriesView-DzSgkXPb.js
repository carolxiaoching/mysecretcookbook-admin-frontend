import{n as B,o as P,d as U,p as j}from"./api-DxEg9CdQ.js";import{l as T,m as S,r as c,V as q,E as G,a as R,o as x,c as C,b as e,d as f,w as k,W as I,e as h,n as L,t as r,f as O,j as z,F,L as W,O as H}from"./index-DlbT9Ik_.js";import{_ as J,a as K}from"./DelModal-DFTdoJuw.js";const Q={class:"modal-dialog modal-dialog-centered"},X={class:"modal-content overflow-hidden"},Y={class:"p-11"},Z={class:"modal-title title mb-8",id:"categoryEditModalLabel"},ee=e("span",{class:"title-icon bg-dark-subtl"},[e("i",{class:"bi bi-pencil-fill"})],-1),te=e("label",{for:"title",class:"form-label"},[e("span",{class:"text-danger"},"*"),h(" 分類標題： ")],-1),ae={key:0},se={class:"d-flex px-11 py-8 bg-light"},le=["onClick"],oe=["disabled"],de={__name:"CategoryEditModal",props:{tempCategory:{type:Object,default(){return{id:"",title:"",createdAt:"",updatedAt:""}}}},emits:["getCategories"],setup(D,{expose:A,emit:w}){const $=T(),p=S(),{openLoading:u,closeLoading:v}=$,{pushMessage:g}=p,_=c(null),{openModal:M,hideModal:m}=q(_),s=c({id:"",title:"",createdAt:"",updatedAt:""});A({openModal:M,hideModal:m});const b=D,E=w;G(b,i=>{s.value=i.tempCategory});async function V(i,{resetForm:l}){var o,d;u();const a=s.value.id?B:P,t=s.value.id?"更新":"新增";try{const n=await a({title:s.value.title},s.value.id),{status:y}=n.data;y==="success"?(g({style:"success",title:`${t}成功`,text:`分類${t}成功，請等待載入畫面`}),l(),E("getCategories")):g({style:"danger",title:`${t}失敗`,text:`分類${t}失敗，請重整網頁`}),v(),m()}catch(n){g({style:"danger",title:`${t}失敗`,text:((d=(o=n.response)==null?void 0:o.data)==null?void 0:d.message)||`分類${t}失敗，請重整網頁`}),v()}}return(i,l)=>{const a=R("VField"),t=R("ErrorMessage"),o=R("VForm");return x(),C("div",{class:"modal fade",id:"categoryEditModal",tabindex:"-1","aria-labelledby":"categoryEditModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false",ref_key:"categoryEditModalRef",ref:_},[e("div",Q,[e("div",X,[f(o,{class:"modal-body p-0",ref:"form",onSubmit:V},{default:k(({errors:d,meta:n,resetForm:y})=>[e("div",Y,[e("h1",Z,[ee,I(i.$slots,"modal-header",{},()=>[h("標題")])]),e("div",{class:L({"mb-8":s.value.createdAt})},[te,f(a,{type:"text",name:"分類標題",id:"title",class:L(["form-control",{"is-invalid":d.分類標題}]),placeholder:"請輸入分類標題",rules:"required",modelValue:s.value.title,"onUpdate:modelValue":l[0]||(l[0]=N=>s.value.title=N),required:""},null,8,["class","modelValue"]),f(t,{name:"分類標題",class:"invalid-feedback"})],2),s.value.createdAt?(x(),C("div",ae,[e("p",null,"建立時間："+r(i.$getTime(s.value.createdAt)),1),e("p",null,"更新時間："+r(i.$getTime(s.value.updatedAt)),1)])):O("",!0)]),e("div",se,[e("button",{type:"button",class:"w-50 btn btn-outline-primary me-8","data-bs-dismiss":"modal",onClick:y}," 取消 ",8,le),e("button",{type:"submit","aria-disabled":"true",class:L(["w-50 btn btn-primary",{disabled:!n.valid}]),disabled:!n.valid}," 確定送出 ",10,oe)])]),_:3},512)])])],512)}}},ne=e("h1",{class:"mb-4 h3"},"分類管理",-1),ie={class:"mb-8 text-end"},ce=e("i",{class:"bi bi-plus-lg me-8"},null,-1),re={class:"table-responsive"},ue={class:"table mb-14 align-middle"},pe=e("thead",null,[e("tr",{class:"table-active"},[e("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"ID 編號"),e("th",{class:"text-center"},"分類名稱"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"建立時間"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"更新時間"),e("th",{class:"text-center",width:"200"},"編輯")])],-1),ge={class:"d-none d-sm-table-cell text-center"},_e={class:"text-center"},me={class:"d-none d-xxl-table-cell text-center"},be={class:"d-none d-xxl-table-cell text-center"},ye={class:"text-center"},he={class:"btn-group btn-group-sm",role:"group"},fe=["onClick"],ve=["onClick"],Me={__name:"CategoriesView",setup(D){const A=T(),w=S(),{openLoading:$,closeLoading:p}=A,{pushMessage:u}=w,v=c([]),g=c({}),_=c(null),M=c(null),m=c({id:"",title:""}),s=c({id:"",title:"",createdAt:"",updatedAt:""});async function b(l=1){var a,t;$();try{const o=await U(),{data:d,status:n}=o.data;if(n==="success"){const y=H(d,l);v.value=y.result,g.value=y.pagination}else u({style:"danger",title:"載入失敗",text:"載入失敗，請重整網頁"});p()}catch(o){u({style:"danger",title:"載入失敗",text:((t=(a=o.response)==null?void 0:a.data)==null?void 0:t.message)||"載入失敗，請重整網頁"}),p()}}async function E(l){var a,t,o;$();try{const d=await j(l),{status:n}=d.data;n==="success"?(u({style:"success",title:"刪除成功",text:"分類刪除成功，請等待載入畫面"}),b()):u({style:"danger",title:"刪除失敗",text:"分類刪除失敗，請重整網頁"}),(a=_.value)==null||a.hideModal(),p()}catch(d){u({style:"danger",title:"刪除失敗",text:((o=(t=d.response)==null?void 0:t.data)==null?void 0:o.message)||"分類刪除失敗，請重整網頁"}),p()}}function V(l){var a;m.value={id:l._id,title:l.title},(a=_.value)==null||a.openModal()}function i(l,a){var t;l==="create"?s.value={id:"",title:"",createdAt:"",updatedAt:""}:s.value={id:a._id,title:a.title,createdAt:a.createdAt,updatedAt:a.updatedAt},(t=M.value)==null||t.openModal()}return z(()=>{b()}),(l,a)=>(x(),C(F,null,[ne,e("div",ie,[e("button",{type:"button",class:"btn btn-primary",onClick:a[0]||(a[0]=t=>i("create"))},[ce,h(" 新增分類 ")])]),e("div",re,[e("table",ue,[pe,e("tbody",null,[(x(!0),C(F,null,W(v.value,t=>(x(),C("tr",{key:t._id},[e("td",ge,"#"+r(t._id.slice(-5)),1),e("td",_e,r(t.title),1),e("td",me,r(l.$getTime(t.createdAt)),1),e("td",be,r(l.$getTime(t.updatedAt)),1),e("td",ye,[e("div",he,[e("button",{type:"button",class:"btn btn-outline-dark",onClick:o=>i("edit",t)}," 編輯 ",8,fe),e("button",{type:"button",class:"btn btn-outline-danger",onClick:o=>V(t)}," 刪除 ",8,ve)])])]))),128))])])]),f(J,{pagination:g.value,onUpdatePage:b},null,8,["pagination"]),f(K,{ref_key:"delModalRef",ref:_,"del-id":m.value.id,onDelItem:E},{"modal-header":k(()=>[h(" 刪除分類 ")]),"modal-content":k(()=>[h(" 確定要刪除 "),e("strong",null," 分類： "+r(m.value.title),1)]),_:1},8,["del-id"]),f(de,{ref_key:"categoryEditModalRef",ref:M,"temp-category":s.value,onGetCategories:b},{"modal-header":k(()=>[h(r(s.value.id?"編輯分類":"新增分類"),1)]),_:1},8,["temp-category"])],64))}};export{Me as default};
