import{u as N,P as q,l as R,m as E,r as h,j as F,a as b,o as j,c as B,b as e,d as i,w as p,n as f,e as C}from"./index-DlbT9Ik_.js";import{g as S,h as A}from"./api-DxEg9CdQ.js";import{_ as D}from"./UploadComponent-ltrW3RMi.js";const L={class:"container-fluid"},T={class:"row gx-16 justify-content-center"},$=e("div",{class:"col-12 mb-14"},[e("h1",{class:"h3"},"編輯會員")],-1),z={class:"col-12 col-xxl-6 mb-16"},G={class:"d-flex flex-column h-100 py-16 px-14 px-md-16 bg-white rounded shadow-sm"},P=e("h2",{class:"title mb-11"},[e("span",{class:"title-icon bg-secondary-subtle"},[e("i",{class:"bi bi-image-fill"})]),e("span",null," 會員頭像 ")],-1),H={class:"flex-fill d-flex flex-column justify-content-center m-lg-16"},J={class:"col-12 col-xxl-6 mb-16"},K={class:"p-14 p-md-16 bg-white shadow-sm rounded"},O=e("h2",{class:"title mb-11"},[e("span",{class:"title-icon bg-secondary-subtle"},[e("i",{class:"bi bi-image-fill"})]),e("span",null," 基本資料 ")],-1),Q={class:"mb-8"},W=e("label",{for:"id",class:"form-label"}," 會員編號： ",-1),X=["value"],Y={class:"mb-8"},Z=e("label",{for:"email",class:"form-label"}," 電子信箱： ",-1),ee=["value"],se={class:"mb-8"},te=e("label",{for:"nickName",class:"form-label"}," 暱稱： ",-1),ae={class:"mb-8"},le=e("label",{for:"gender",class:"form-label"}," 性別： ",-1),oe=e("option",{value:"secret",select:""},"秘密",-1),ie=e("option",{value:"female"},"女生",-1),ne=e("option",{value:"male"},"男生",-1),de={class:"mb-16"},ce=e("label",{for:"role",class:"form-label"}," 權限： ",-1),re=e("option",{value:"member",select:""},"會員",-1),me=e("option",{value:"admin"},"管理員",-1),ue={class:"text-center"},_e=["disabled"],be={class:"col-12 text-center"},pe=e("i",{class:"bi bi-arrow-90deg-left me-8"},null,-1),xe={__name:"MemberEditView",setup(fe){const v=N(),V=q(),k=R(),w=E(),{openLoading:g,closeLoading:_}=k,{pushMessage:c}=w,M=h(null),r=h({}),l=h({});async function U(t){var s,o;g();try{const a=await S(t),{status:n,data:m}=a.data;n==="success"?(r.value={...m},l.value={...m}):(c({style:"danger",title:"載入失敗",text:"會員取得失敗，將轉回會員列表頁面"}),v.push("/dashboard/member")),_()}catch(a){c({style:"danger",title:"載入失敗",text:((o=(s=a.response)==null?void 0:s.data)==null?void 0:o.message)||"會員取得失敗，將轉回會員列表頁面"}),_(),v.push("/dashboard/member")}}async function x(t,s){var o,a;g(),s!=="updateAvatarImgUrl"&&delete t.avatarImgUrl;try{const n=await A(t,r.value._id),{status:m,data:d}=n.data;m==="success"?(c({style:"success",title:"更新成功",text:"更新成功"}),r.value={...d},l.value={...d}):c({style:"danger",title:"更新失敗",text:"更新失敗，請重整網頁"}),_()}catch(n){c({style:"danger",title:"更新失敗",text:((a=(o=n.response)==null?void 0:o.data)==null?void 0:a.message)||"更新失敗，請重整網頁"}),_()}}function I(t){x({avatarImgUrl:t},"updateAvatarImgUrl")}return F(()=>{const{id:t}=V.params;t?U(t):(c({style:"danger",title:"請輸入正確會員 ID",text:"會員 ID 錯誤"}),v.push("/dashboard/member"))}),(t,s)=>{const o=b("VField"),a=b("ErrorMessage"),n=b("VForm"),m=b("router-link");return j(),B("div",L,[e("div",T,[$,e("div",z,[e("div",G,[P,e("div",H,[i(D,{"temp-image-url":r.value.avatarImgUrl,imageType:"avatar",onUpdateImage:I},null,8,["temp-image-url"])])])]),e("div",J,[e("div",K,[O,i(n,{ref_key:"formRef",ref:M,onSubmit:s[3]||(s[3]=d=>x(l.value))},{default:p(({errors:d,meta:y})=>[e("div",Q,[W,e("input",{type:"text",name:"id",id:"id",class:"form-control",value:r.value._id,disabled:""},null,8,X)]),e("div",Y,[Z,e("input",{type:"email",name:"email",id:"email",class:"form-control",value:r.value.email,disabled:""},null,8,ee)]),e("div",se,[te,i(o,{type:"text",name:"暱稱",id:"nickName",class:f(["form-control",{"is-invalid":d.暱稱}]),placeholder:"請輸入暱稱",rules:"required",modelValue:l.value.nickName,"onUpdate:modelValue":s[0]||(s[0]=u=>l.value.nickName=u),required:""},null,8,["class","modelValue"]),i(a,{name:"暱稱",class:"invalid-feedback"})]),e("div",ae,[le,i(o,{as:"select",name:"性別",id:"gender",class:f(["form-select",{"is-invalid":d.性別}]),placeholder:"請選擇性別",rules:"required",modelValue:l.value.gender,"onUpdate:modelValue":s[1]||(s[1]=u=>l.value.gender=u),required:""},{default:p(()=>[oe,ie,ne]),_:2},1032,["class","modelValue"]),i(a,{name:"性別",class:"invalid-feedback"})]),e("div",de,[ce,i(o,{as:"select",name:"權限",id:"role",class:f(["form-select",{"is-invalid":d.權限}]),placeholder:"請選擇權限",rules:"required",modelValue:l.value.role,"onUpdate:modelValue":s[2]||(s[2]=u=>l.value.role=u),required:""},{default:p(()=>[re,me]),_:2},1032,["class","modelValue"]),i(a,{name:"權限",class:"invalid-feedback"})]),e("div",ue,[e("button",{type:"submit","aria-disabled":"true",class:f(["btn btn-primary w-75",{disabled:!y.valid}]),disabled:!y.valid}," 更新基本資料 ",10,_e)])]),_:1},512)])]),e("div",be,[i(m,{to:"/dashboard/members",class:"btn btn-outline-primary"},{default:p(()=>[pe,C(" 返回會員列表 ")]),_:1})])])])}}};export{xe as default};
