import{q,r as B,e as P,s as U}from"./api-DxEg9CdQ.js";import{l as F,m as S,r as c,V as j,E as G,a as C,o as x,c as $,b as t,d as v,w as k,W as I,e as f,n as R,t as r,f as O,j as z,F as D,L as W,O as H}from"./index-DlbT9Ik_.js";import{_ as J,a as K}from"./DelModal-DFTdoJuw.js";const Q={class:"modal-dialog modal-dialog-centered"},X={class:"modal-content overflow-hidden"},Y={class:"p-11"},Z={class:"modal-title title mb-8",id:"tagEditModalLabel"},tt=t("span",{class:"title-icon bg-dark-subtl"},[t("i",{class:"bi bi-pencil-fill"})],-1),et=t("label",{for:"title",class:"form-label"},[t("span",{class:"text-danger"},"*"),f(" 標籤標題： ")],-1),at={key:0},st={class:"d-flex px-11 py-8 bg-light"},lt=["onClick"],ot=["disabled"],dt={__name:"TagEditModal",props:{tempTag:{type:Object,default(){return{id:"",title:"",createdAt:"",updatedAt:""}}}},emits:["getTags"],setup(L,{expose:A,emit:w}){const M=F(),p=S(),{openLoading:u,closeLoading:y}=M,{pushMessage:g}=p,_=c(null),{openModal:T,hideModal:m}=j(_),s=c({id:"",title:"",createdAt:"",updatedAt:""});A({openModal:T,hideModal:m});const b=L,E=w;G(b,i=>{s.value=i.tempTag});async function V(i,{resetForm:l}){var o,d;u();const a=s.value.id?q:B,e=s.value.id?"更新":"新增";try{const n=await a({title:s.value.title},s.value.id),{status:h}=n.data;h==="success"?(g({style:"success",title:`${e}成功`,text:`標籤${e}成功，請等待載入畫面`}),l(),E("getTags")):g({style:"danger",title:`${e}失敗`,text:`標籤${e}失敗，請重整網頁`}),y(),m()}catch(n){g({style:"danger",title:`${e}失敗`,text:((d=(o=n.response)==null?void 0:o.data)==null?void 0:d.message)||`標籤${e}失敗，請重整網頁`}),y()}}return(i,l)=>{const a=C("VField"),e=C("ErrorMessage"),o=C("VForm");return x(),$("div",{class:"modal fade",id:"tagEditModal",tabindex:"-1","aria-labelledby":"tagEditModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false",ref_key:"tagEditModalRef",ref:_},[t("div",Q,[t("div",X,[v(o,{class:"modal-body p-0",ref:"form",onSubmit:V},{default:k(({errors:d,meta:n,resetForm:h})=>[t("div",Y,[t("h1",Z,[tt,I(i.$slots,"modal-header",{},()=>[f("標題")])]),t("div",{class:R({"mb-8":s.value.createdAt})},[et,v(a,{type:"text",name:"標籤標題",id:"title",class:R(["form-control",{"is-invalid":d.標籤標題}]),placeholder:"請輸入標籤標題",rules:"required",modelValue:s.value.title,"onUpdate:modelValue":l[0]||(l[0]=N=>s.value.title=N),required:""},null,8,["class","modelValue"]),v(e,{name:"標籤標題",class:"invalid-feedback"})],2),s.value.createdAt?(x(),$("div",at,[t("p",null,"建立時間："+r(i.$getTime(s.value.createdAt)),1),t("p",null,"更新時間："+r(i.$getTime(s.value.updatedAt)),1)])):O("",!0)]),t("div",st,[t("button",{type:"button",class:"w-50 btn btn-outline-primary me-8","data-bs-dismiss":"modal",onClick:h}," 取消 ",8,lt),t("button",{type:"submit","aria-disabled":"true",class:R(["w-50 btn btn-primary",{disabled:!n.valid}]),disabled:!n.valid}," 確定送出 ",10,ot)])]),_:3},512)])])],512)}}},nt=t("h1",{class:"mb-4 h3"},"標籤管理",-1),it={class:"mb-8 text-end"},ct=t("i",{class:"bi bi-plus-lg me-8"},null,-1),rt={class:"table-responsive"},ut={class:"table mb-14 align-middle"},pt=t("thead",null,[t("tr",{class:"table-active"},[t("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"ID 編號"),t("th",{class:"text-center"},"標籤名稱"),t("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"建立時間"),t("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"更新時間"),t("th",{class:"text-center",width:"200"},"編輯")])],-1),gt={class:"d-none d-sm-table-cell text-center"},_t={class:"text-center"},mt={class:"d-none d-xxl-table-cell text-center"},bt={class:"d-none d-xxl-table-cell text-center"},ht={class:"text-center"},ft={class:"btn-group btn-group-sm",role:"group"},vt=["onClick"],yt=["onClick"],Tt={__name:"TagsView",setup(L){const A=F(),w=S(),{openLoading:M,closeLoading:p}=A,{pushMessage:u}=w,y=c([]),g=c({}),_=c(null),T=c(null),m=c({id:"",title:""}),s=c({id:"",title:"",createdAt:"",updatedAt:""});async function b(l=1){var a,e;M();try{const o=await P(),{data:d,status:n}=o.data;if(n==="success"){const h=H(d,l);y.value=h.result,g.value=h.pagination}else u({style:"danger",title:"載入失敗",text:"載入失敗，請重整網頁"});p()}catch(o){u({style:"danger",title:"載入失敗",text:((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.message)||"載入失敗，請重整網頁"}),p()}}async function E(l){var a,e,o;M();try{const d=await U(l),{status:n}=d.data;n==="success"?(u({style:"success",title:"刪除成功",text:"標籤刪除成功，請等待載入畫面"}),b()):u({style:"danger",title:"刪除失敗",text:"標籤刪除失敗，請重整網頁"}),(a=_.value)==null||a.hideModal(),p()}catch(d){u({style:"danger",title:"刪除失敗",text:((o=(e=d.response)==null?void 0:e.data)==null?void 0:o.message)||"標籤刪除失敗，請重整網頁"}),p()}}function V(l){var a;m.value={id:l._id,title:l.title},(a=_.value)==null||a.openModal()}function i(l,a){var e;l==="create"?s.value={id:"",title:"",createdAt:"",updatedAt:""}:s.value={id:a._id,title:a.title,createdAt:a.createdAt,updatedAt:a.updatedAt},(e=T.value)==null||e.openModal()}return z(()=>{b()}),(l,a)=>(x(),$(D,null,[nt,t("div",it,[t("button",{type:"button",class:"btn btn-primary",onClick:a[0]||(a[0]=e=>i("create"))},[ct,f(" 新增標籤 ")])]),t("div",rt,[t("table",ut,[pt,t("tbody",null,[(x(!0),$(D,null,W(y.value,e=>(x(),$("tr",{key:e._id},[t("td",gt,"#"+r(e._id.slice(-5)),1),t("td",_t,r(e.title),1),t("td",mt,r(l.$getTime(e.createdAt)),1),t("td",bt,r(l.$getTime(e.updatedAt)),1),t("td",ht,[t("div",ft,[t("button",{type:"button",class:"btn btn-outline-dark",onClick:o=>i("edit",e)}," 編輯 ",8,vt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:o=>V(e)}," 刪除 ",8,yt)])])]))),128))])])]),v(J,{pagination:g.value,onUpdatePage:b},null,8,["pagination"]),v(K,{ref_key:"delModalRef",ref:_,"del-id":m.value.id,onDelItem:E},{"modal-header":k(()=>[f(" 刪除標籤 ")]),"modal-content":k(()=>[f(" 確定要刪除 "),t("strong",null," 標籤： "+r(m.value.title),1)]),_:1},8,["del-id"]),v(dt,{ref_key:"tagEditModalRef",ref:T,"temp-tag":s.value,onGetTags:b},{"modal-header":k(()=>[f(r(s.value.id?"編輯標籤":"新增標籤"),1)]),_:1},8,["temp-tag"])],64))}};export{Tt as default};
