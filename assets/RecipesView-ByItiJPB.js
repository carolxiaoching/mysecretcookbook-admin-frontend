import{c as L,e as V,d as A,i as B}from"./api-DxEg9CdQ.js";import{l as G,m as S,r as u,j as F,a as j,o as c,c as o,b as e,d as p,w as b,F as w,L as M,O as z,e as h,t as n,I,J as E,Q as J,n as O}from"./index-DlbT9Ik_.js";import{_ as Q,a as q}from"./DelModal-DFTdoJuw.js";const H=e("h1",{class:"mb-4 h3"},"食譜管理",-1),K={class:"mb-8 text-end"},W=e("i",{class:"bi bi-plus-lg me-8"},null,-1),X={class:"table-responsive"},Y={class:"table align-middle"},Z=e("thead",null,[e("tr",{class:"table-active"},[e("th",{class:"d-none d-md-table-cell text-center",width:"120"},"ID 編號"),e("th",{class:"text-center"},"食譜名稱"),e("th",{class:"d-none d-md-table-cell text-center",width:"120"},"分類"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"標籤"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"80"},"收藏人數"),e("th",{class:"d-none d-lg-table-cell text-center",width:"120"},"發布者"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"120"},"是否啟用"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"120"},"建立時間"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"120"},"更新時間"),e("th",{class:"text-center",width:"200"},"編輯")])],-1),ee={class:"d-none d-md-table-cell text-center"},te={class:"text-center"},se={class:"d-flex align-items-center"},ae=["src"],le={key:1,class:"thumbnailDefault me-4"},ne=e("i",{class:"bi bi-person-fill"},null,-1),ce=[ne],oe={class:"d-none d-md-table-cell text-center"},de={class:"d-none d-xxl-table-cell text-center"},ie={class:"d-flex flex-wrap list-unstyled"},re={class:"badge text-bg-secondary"},_e={class:"d-none d-xxl-table-cell text-center"},ue={class:"d-none d-lg-table-cell text-center"},he={class:"d-flex align-items-center"},ge=["src"],xe={key:1,class:"thumbnailDefault me-4 rounded-circle"},pe=e("i",{class:"bi bi-person-fill"},null,-1),be=[pe],me={class:"d-none d-xxl-table-cell text-center"},fe={class:"d-none d-xxl-table-cell text-center"},ve={class:"d-none d-xxl-table-cell text-center"},ye={class:"text-center"},we={class:"btn-group btn-group-sm",role:"group"},ke=["onClick"],Re={class:"mb-8"},Ne={__name:"RecipesView",setup(De){const N=G(),P=S(),{openLoading:m,closeLoading:i}=N,{pushMessage:r}=P,k=u([]),R=u([]),D=u([]),C=u({}),f=u(null),x=u({id:"",title:""});async function v(s=1){var a,l;m();try{const t=await L(),{data:d,status:_}=t.data;if(_==="success"){const g=z(d,s);k.value=g.result,C.value=g.pagination}else r({style:"danger",title:"載入失敗",text:"載入失敗，請重整網頁"});i()}catch(t){r({style:"danger",title:"載入失敗",text:((l=(a=t.response)==null?void 0:a.data)==null?void 0:l.message)||"載入失敗，請重整網頁"}),i()}}async function $(){var s,a;m();try{const l=await V(),t=await A();D.value=l.data.data,R.value=t.data.data,await v(),i()}catch(l){r({style:"danger",title:"載入失敗",text:((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||"載入失敗，請重整網頁"}),i()}}async function T(s){var a,l,t;m();try{const d=await B(s),{status:_}=d.data;_==="success"?(r({style:"success",title:"刪除成功",text:"刪除成功，請等待載入畫面"}),v()):r({style:"danger",title:"刪除失敗",text:"刪除失敗，請重整網頁"}),(a=f.value)==null||a.hideModal(),i()}catch(d){r({style:"danger",title:"刪除失敗",text:((t=(l=d.response)==null?void 0:l.data)==null?void 0:t.message)||"刪除失敗，請重整網頁"}),i()}}function U(s){var a;x.value={id:s._id,title:s.title},(a=f.value)==null||a.openModal()}return F(()=>{$()}),(s,a)=>{const l=j("router-link");return c(),o(w,null,[H,e("div",K,[p(l,{to:"/dashboard/recipe/new",class:"btn btn-primary"},{default:b(()=>[W,h(" 新增食譜 ")]),_:1})]),e("div",X,[e("table",Y,[Z,e("tbody",null,[(c(!0),o(w,null,M(k.value,t=>{var d,_,g;return c(),o("tr",{key:t._id},[e("td",ee,"#"+n(t._id.slice(-5)),1),e("td",te,[e("div",se,[t.coverImgUrl?(c(),o("img",{key:0,src:t.coverImgUrl,class:"thumbnail me-4"},null,8,ae)):(c(),o("div",le,ce)),h(" "+n(t.title),1)])]),e("td",oe,n(I(E)(R.value,t.category)),1),e("td",de,[e("ul",ie,[(c(!0),o(w,null,M(t.tags,y=>(c(),o("li",{class:"me-4 fs-6",key:y},[e("span",re,n(I(J)(D.value,y)),1)]))),128))])]),e("td",_e,n(t.collects.length),1),e("td",ue,[e("div",he,[(d=t.user)!=null&&d.avatarImgUrl?(c(),o("img",{key:0,src:(_=t.user)==null?void 0:_.avatarImgUrl,class:"thumbnail me-4 rounded-circle"},null,8,ge)):(c(),o("div",xe,be)),h(" "+n((g=t.user)==null?void 0:g.nickName),1)])]),e("td",me,[e("span",{class:O({"text-success text-opacity-75":t.isPublic,"text-muted":!t.isPublic})},n(t.isPublic?"啟用":"未啟用"),3)]),e("td",fe,n(s.$getTime(t.createdAt)),1),e("td",ve,n(s.$getTime(t.updatedAt)),1),e("td",ye,[e("div",we,[p(l,{to:`/dashboard/recipe/${t._id}`,class:"btn btn-outline-dark"},{default:b(()=>[h(" 編輯 ")]),_:2},1032,["to"]),e("button",{type:"button",class:"btn btn-outline-danger",onClick:y=>U(t)}," 刪除 ",8,ke)])])])}),128))])])]),p(Q,{pagination:C.value,onUpdatePage:v},null,8,["pagination"]),p(q,{ref_key:"delModalRef",ref:f,"del-id":x.value.id,onDelItem:T},{"modal-header":b(()=>[h(" 刪除食譜 #"+n(x.value.id.slice(-5)),1)]),"modal-content":b(()=>[e("p",Re,[h(" 確定要刪除食譜： "),e("strong",null,n(x.value.title),1)])]),_:1},8,["del-id"])],64)}}};export{Ne as default};
