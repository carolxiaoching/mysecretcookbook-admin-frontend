import{t as C,u as L}from"./api-N8pudNG6.js";import{r as c,a1 as T,o as p,c as b,b as e,a2 as k,e as r,l as S,m as V,A as B,F as w,U as F,d as M,w as u,t as n}from"./index-CIqGYXyv.js";import{_ as j,a as E}from"./DelModal-ZxMk4JEI.js";const G={class:"modal-dialog modal-dialog-centered"},P={class:"modal-content overflow-hidden"},q={class:"modal-body p-0"},z={class:"p-11"},H={class:"modal-title title mb-8",id:"imageModalLabel"},J=e("span",{class:"titleIcon bg-dark-subtle"},[e("i",{class:"bi bi-pencil-fill"})],-1),K={class:"my-11 text-center"},O=e("div",{class:"px-11 py-8 bg-light text-center"},[e("button",{type:"button",class:"w-50 btn btn-primary","data-bs-dismiss":"modal"},"關閉")],-1),Q={__name:"ImageModal",setup(A,{expose:f}){const _=c(null),{openModal:g,hideModal:i}=T(_);return f({openModal:g,hideModal:i}),(o,x)=>(p(),b("div",{class:"modal fade",id:"imageModal",tabindex:"-1","aria-labelledby":"imageModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false",ref_key:"imageModalRef",ref:_},[e("div",G,[e("div",P,[e("div",q,[e("div",z,[e("h1",H,[J,k(o.$slots,"modal-header",{},()=>[r("標題")])]),e("div",K,[k(o.$slots,"modal-image",{},()=>[r("圖片")])]),k(o.$slots,"modal-content",{},()=>[r("內容")])]),O])])])],512))}},W=e("h1",{class:"mb-14 h3"},"圖片管理",-1),X={class:"table-responsive"},Y={class:"table mb-14 align-middle"},Z=e("thead",null,[e("tr",{class:"table-active"},[e("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"ID 編號"),e("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"圖片類型"),e("th",{class:"text-center"},"圖片網址"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"上傳會員"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"建立時間"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"更新時間"),e("th",{class:"text-center",width:"160"},"編輯")])],-1),ee={class:"d-none d-sm-table-cell text-center"},te={class:"d-none d-sm-table-cell text-center"},ae={class:"text-center"},se={class:"d-flex flex-column flex-md-row justify-content-center align-items-center"},le=["src"],ne=["href"],oe={class:"d-none d-xxl-table-cell text-center"},de={class:"d-none d-xxl-table-cell text-center"},ce={class:"d-none d-xxl-table-cell text-center"},ie={class:"text-center"},re={class:"btn-group btn-group-sm",role:"group"},me=["onClick"],ue=["onClick"],_e={class:"mb-8"},ge=["src"],he=["src"],pe=e("label",{for:"imageUrl",class:"form-label"},"網址連結：",-1),be=["value"],ye={__name:"ImagesView",setup(A){const f=S(),_=V(),{openLoading:g,closeLoading:i}=f,{pushMessage:o}=_,x=c([]),$=c({}),v=c(null),U=c(null),h=c({id:"",imageUrl:""}),d=c({id:"",type:"",imageUrl:"",user:{nickName:""},createdAt:"",updatedAt:""});async function y(a=1){var s,t;g();try{const l=await C({page:a});x.value=l.data.data.results,$.value=l.data.data.pagination,i()}catch(l){o({style:"danger",title:"載入失敗",text:((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"載入失敗，請重整網頁"}),i()}}async function I(a){var s,t,l;g();try{const m=await L(a),{status:D}=m.data;D==="success"?(o({style:"success",title:"刪除成功",text:"圖片刪除成功，請等待載入畫面"}),y()):o({style:"danger",title:"刪除失敗",text:"圖片刪除失敗，請重整網頁"}),(s=v.value)==null||s.hideModal(),i()}catch(m){o({style:"danger",title:"刪除失敗",text:((l=(t=m.response)==null?void 0:t.data)==null?void 0:l.message)||"圖片刪除失敗，請重整網頁"}),i()}}function N(a){var s;h.value={id:a._id,imageUrl:a.imageUrl},(s=v.value)==null||s.openModal()}function R(a){var s,t;d.value={id:a._id,type:a.type,imageUrl:a.imageUrl,userNickName:(s=a.user)==null?void 0:s.nickName,createdAt:a.createdAt,updatedAt:a.updatedAt},(t=U.value)==null||t.openModal()}return B(()=>{y()}),(a,s)=>(p(),b(w,null,[W,e("div",X,[e("table",Y,[Z,e("tbody",null,[(p(!0),b(w,null,F(x.value,t=>{var l;return p(),b("tr",{key:t._id},[e("td",ee,"#"+n(t._id.slice(-5)),1),e("td",te,n(t.type),1),e("td",ae,[e("div",se,[e("img",{src:t.imageUrl,alt:"",class:"thumbnail me-md-4"},null,8,le),e("a",{href:t.imageUrl,target:"_blank",class:"text-decoration-underline"}," 開啟圖片 ",8,ne)])]),e("td",oe,n((l=t.user)==null?void 0:l.nickName),1),e("td",de,n(a.$getTime(t.createdAt)),1),e("td",ce,n(a.$getTime(t.updatedAt)),1),e("td",ie,[e("div",re,[e("button",{type:"button",class:"btn btn-outline-dark",onClick:m=>R(t)}," 看更多 ",8,me),e("button",{type:"button",class:"btn btn-outline-danger",onClick:m=>N(t)}," 刪除 ",8,ue)])])])}),128))])])]),M(j,{pagination:$.value,onUpdatePage:y},null,8,["pagination"]),M(E,{ref_key:"delModalRef",ref:v,"del-id":h.value.id,onDelItem:I},{"modal-header":u(()=>[r(" 刪除圖片 ")]),"modal-content":u(()=>[e("p",_e,[r(" 確定要刪除 "),e("strong",null," 圖片：#"+n(h.value.id.slice(-5)),1)]),e("img",{src:h.value.imageUrl,class:"img-thumbnail",style:{"max-height":"12rem"}},null,8,ge)]),_:1},8,["del-id"]),M(Q,{ref_key:"imageModalRef",ref:U},{"modal-header":u(()=>[r(" 圖片 #"+n(d.value.id.slice(-5)),1)]),"modal-image":u(()=>[e("img",{src:d.value.imageUrl,class:"img-thumbnail",style:{"max-height":"20rem"}},null,8,he)]),"modal-content":u(()=>[pe,e("input",{type:"text",id:"imageUrl",class:"form-control mb-8",value:d.value.imageUrl,disabled:""},null,8,be),e("p",null,"上傳會員："+n(d.value.userNickName),1),e("p",null,"建立時間："+n(a.$getTime(d.value.createdAt)),1),e("p",null,"更新時間："+n(a.$getTime(d.value.updatedAt)),1)]),_:1},512)],64))}};export{ye as default};
